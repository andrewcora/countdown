<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cuenta regresiva al 1 de noviembre</title>
  <style>
    /* ===== ORIGINAL COUNTDOWN STYLES (sin cambios) ===== */
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: background 600ms ease; /* smooth when switching to letter */
    }
    h1 {
      font-size: 2em;
      color: #333;
      margin-bottom: 10px;
    }
    #countdown {
      font-size: 2.5em;
      font-weight: bold;
      color: #007bff;
      background-color: white;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    span { color: #212529; }

    /* ===== Helpers ===== */
    .hidden { display: none !important; }

    /* ===== LETTER VIEW (visible cuando llega la fecha) ===== */
    body.celebrate {
      background:
        radial-gradient(1200px 800px at 50% -20%, #fff6e5 0%, #fffaf0 45%, #ffffff 80%),
        repeating-linear-gradient(115deg, rgba(0,0,0,.02) 0 4px, transparent 4px 10px);
      height: auto; min-height: 100vh; padding: 24px;
      align-items: stretch;
    }
    /* IMPORTANT: .letter is display:block by default; we hide it only via .hidden */
    .letter {
      display: block;
      width: min(900px, 92vw);
      margin: 0 auto;
      background: linear-gradient(180deg, #f4ecd8, #e8dbba);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 16px;
      box-shadow: 0 30px 70px rgba(0,0,0,.18), inset 0 0 0 1px rgba(255,255,255,.5);
      padding: clamp(18px, 4vw, 36px);
      text-align: left;
      position: relative;
      overflow: hidden;
      animation: fadeIn .6s ease;
    }
    .letter::before {
      content:""; position:absolute; inset:0; pointer-events:none; border-radius:16px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity=".03"/></svg>') repeat;
      mix-blend-mode:multiply; opacity:.6;
    }
    .letter::after {
      content:""; position:absolute; inset:0; pointer-events:none; border-radius:16px;
      box-shadow: inset 0 30px 60px rgba(0,0,0,.08), inset 0 -30px 60px rgba(0,0,0,.08);
    }
    .h {
      margin: 0 0 8px;
      font-weight: 900; color: #5b4631;
      font-size: clamp(26px, 6vw, 40px);
      text-align: center;
    }
    .footer-note {
      margin-top: 18px;
      color: #6d5a43;
      font-size: clamp(16px, 3.8vw, 20px); /* replaces .95rem */
      text-align: center;
    }
    .date-line { text-align: center; color: #6d5a43; margin-bottom: 18px; font-size: .98rem; }
    .msg { font-size: clamp(16px, 2.6vw, 20px); line-height: 1.3; white-space: pre-wrap; color: #2a2520; }
    .typewriter { overflow: hidden; }
    @keyframes caret { 50% { border-color: transparent } }
    .typing { animation: caret 1s steps(1) infinite; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px) } to { opacity: 1; transform: none } }

    /* Confetti (emoji, minimal) */
    .confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 10; }
    .piece { position: absolute; top: -10vh; font-size: 18px; filter: drop-shadow(0 2px 1px rgba(0,0,0,.2)); animation: fall linear forwards; }
    @keyframes fall { to { transform: translateY(110vh) rotate(720deg) } }
  </style>
</head>
<body>
  <!-- === TU COUNTDOWN ORIGINAL === -->
  <h1 id="title">Cuenta regresiva para que Andrea regrese a Le√≥n ü¶Å</h1>
  <div id="countdown">Calculando...</div>

  <!-- === VISTA CARTA (aparece al llegar la fecha / preview) === -->
  <main id="letterWrap" class="letter hidden" role="region" aria-label="Carta">
    <h2 class="h" id="headline">¬°Ya lleg√≥ el gran d√≠a! üéâ</h2>
    <br>    
    <div class="msg typewriter typing" id="letterMessage"><!-- typewriter aqu√≠ --></div>
    <!-- <div class="footer-note">Con cari√±o, <strong>Andr√©s.</strong></div> -->
  </main>
  <div id="confetti" class="confetti" aria-hidden="true"></div>

  <script>
    /* ======= PERSONALIZA TU MENSAJE ======= */
    const LETTER_TEXT =
`Querida Andrea,\n
Por fin se cumplieron esos 4 meses que hace unas semanas parec√≠an eternos. S√© que no fue f√°cil, que hubo muchos d√≠as cansados, y aunque no pude verte en acci√≥n durante todo tu servicio, cr√©eme que al hablar estas √∫ltimas semanas contigo realmente me sorprendi√≥ todo lo que haces y, en cierta manera, me motiva <b>tu fortaleza, resiliencia y actitud de cada d√≠a</b> (por eso eres mi h√©roe ü¶∏‚Äç‚ôÄÔ∏è). 

Hoy empieza una nueva etapa que estoy seguro estar√° llena de muchas sorpresas, planes y risas. Como cada etapa, tendr√° sus altas y bajas, pero si de algo puedes estar segura es que en m√≠ encontrar√°s a alguien con quien apoyarte.

No s√© t√∫, pero a m√≠ me emociona lo que est√° por venir, y eso que ni es mi etapa ni estoy terminando ning√∫n servicio jajaja. Muchas felicidades de nuevo por este logro, <b>¬°que sepas que eres el orgullo de muchos!</b>

<b>¬°Te quiero mucho!</b> ‚ù§Ô∏è

<i>"No hay nada como volver a un lugar que no ha cambiado para ver cu√°nto has cambiado t√∫."</i>\n

- Con cari√±o, <strong>Andr√©s.</strong>
`;

    /* ====================================== */

    /* ---- Opcional: ?date=YYYY-MM-DD (&preview=1) ---- */
    function parseTargetFromQuery() {
      const p = new URLSearchParams(location.search);
      const raw = p.get("date");
      if (!raw) return null;

      // YYYY-MM-DD o YYYY-MM-DDTHH:mm(:ss) en hora local
      if (/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}(:\d{2})?)?$/.test(raw)) {
        const [dPart, tPart] = raw.split("T");
        const [y,m,d] = dPart.split("-").map(Number);
        if (tPart) {
          const [hh,mm,ss="0"] = tPart.split(":").map(Number);
          return new Date(y, m-1, d, hh, mm, ss);
        }
        return new Date(y, m-1, d, 0, 0, 0);
      }
      const t = new Date(raw); // ‚ÄúOct 1, 2025‚Äù, etc.
      return isNaN(t) ? null : t;
    }
    const TARGET_FALLBACK = new Date("Nov 1, 2025 00:00:00");
    const TARGET_DATE = parseTargetFromQuery() || TARGET_FALLBACK;
    const targetDate = TARGET_DATE.getTime();
    const preview = new URLSearchParams(location.search).get("preview") === "1";

    /* ===== TU L√ìGICA DE COUNTDOWN ORIGINAL ===== */
    function updateCountdown() {
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance < 0) {
        switchToLetter();
        clearInterval(timer);
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      document.getElementById("countdown").innerHTML =
        `<span>${days}</span> d√≠as, <span>${hours}</span> horas, 
         <span>${minutes}</span> minutos, <span>${seconds}</span> segundos`;
    }
    updateCountdown();
    const timer = setInterval(updateCountdown, 1000);

    // Si ya pas√≥ la fecha (o usas preview), mostrar la carta de inmediato
    window.addEventListener("load", () => {
      if (preview || Date.now() >= targetDate) switchToLetter();
    });

    /* ===== Carta: typewriter + confetti y cambio total de vista ===== */
    function headlineForDate(d) {
      const ds = d.toLocaleDateString("es-MX", { day: "numeric", month: "long", year: "numeric" });
      return `ü•≥ ¬°Ya es ${ds}! ü•≥`;
    }
    function typewriter(text, el, speed=14) {
      el.textContent = "";
      let i = 0;
      const step = () => {
        if (i <= text.length) {
          el.innerHTML = text.slice(0, i);
          i++;
          setTimeout(step, speed + (text[i-1] === "\n" ? 140 : 0));
        } else {
          el.classList.remove("typing");
        }
      };
      el.classList.add("typing");
      step();
    }
    function burstConfetti(n=100){
      const EMOJIS=["üéâ","ü™á","üéà","üí´","üåü","üéä"];
      const box=document.getElementById("confetti");
      for(let i=0;i<n;i++){
        const p=document.createElement("div");
        p.className="piece";
        p.textContent=EMOJIS[(Math.random()*EMOJIS.length)|0];
        p.style.left=(Math.random()*100)+"vw";
        p.style.animationDuration=(2.2+Math.random()*1.8)+"s";
        p.style.fontSize=(14+Math.random()*16)+"px";
        box.appendChild(p);
        setTimeout(()=>p.remove(), 4500);
      }
    }
    function switchToLetter(){
      // Cambiar fondo + ocultar countdown
      document.body.classList.add("celebrate");
      document.getElementById("title").classList.add("hidden");
      document.getElementById("countdown").classList.add("hidden");

      // Mostrar carta (quitar solo la clase hidden)
      const wrap = document.getElementById("letterWrap");
      wrap.classList.remove("hidden");

      // Rellenar contenido
      document.getElementById("headline").textContent = headlineForDate(TARGET_DATE);      
      typewriter(LETTER_TEXT, document.getElementById("letterMessage"), 30);
      burstConfetti(110);
    }
  </script>
</body>
</html>
